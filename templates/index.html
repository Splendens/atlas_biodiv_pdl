<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>{{configuration.NOM_APPLICATION}}</title>

        <!-- Jquery -->
        <script type=text/javascript src="{{url_for('static', filename='lib/jquery-1.12.4.min.js') }}"></script>
		    <script type=text/javascript src="{{url_for('static', filename='lib/jquery-ui.min.js') }}"></script>
        <link rel="stylesheet" href="{{url_for('static', filename='lib/jquery-ui.css') }}" />

		<!-- Bootstrap -->
        <link rel="stylesheet" href="{{url_for('static', filename='lib/bootstrap/css/bootstrap.min.css') }}"></link>
        <script type=text/javascript src="{{url_for('static', filename='lib/bootstrap/js/bootstrap.min.js') }}"></script>

        <!-- Leaflet -->
        <link rel="stylesheet" href="{{url_for('static', filename='lib/leaflet/leaflet.css') }}" />
        <script src="{{url_for('static', filename='lib/leaflet/leaflet.js') }}"></script>
        <script src="{{url_for('static', filename='lib/leaflet/leaflet-fullscreen/leafletFullScreen.min.js') }}"></script>
        <link rel="stylesheet" href="{{url_for('static', filename='lib/leaflet/leaflet-fullscreen/leafletFullScreen.css') }}" />

        <!-- Slick -->
        <script src="{{url_for('static', filename='lib/slick-1.8.1/slick.min.js') }}"></script>
        <link rel="stylesheet" href="{{url_for('static', filename='lib/slick-1.8.1/slick-theme.css') }}" />
        <link rel="stylesheet" href="{{url_for('static', filename='lib/slick-1.8.1/slick.css') }}" />

        <!-- CSS Application -->
        <link rel="shortcut icon" href="{{ url_for('static', filename='custom/images/favicon.ico') }}">
        <link rel="stylesheet" href="{{url_for('static', filename='css/atlas.css') }}" />
        <link rel="stylesheet" href="{{url_for('static', filename='css/index.css') }}" />
        <link rel="stylesheet" href="{{url_for('static', filename='custom/custom.css') }}" />

    </head>

    <body>
    	
        {% include 'templates/navbar.html' %}
		<div id="sideBar">
			{% include 'templates/sideBar.html' %}
		</div>
		<div class="container-fluid" id="page">

			<!-- Introduction -->
			{% if configuration.AFFICHAGE_INTRODUCTION %}
				{% include 'static/custom/templates/introduction.html' %}
			{% endif %}
			
			{% if configuration.AFFICHAGE_LOGOS_ORGAS %}
				{% include 'static/custom/templates/logospartenaires.html' %}
			{% endif %}

			{% if configuration.AFFICHAGE_STAT_GLOBALES %}
			<!-- Statistiques globales -->
			<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: center;">
				<div class="panel panel-default stat-panel">
					<div class="row">
						<div class="panel-heading" style="margin-bottom:2%"><strong><h3><b>En quelques chiffres</b></h3></strong></div>
						
						<div class = "col-lg-4 col-md-4 col-sm-6 col-xs-12 stat-object">
							<div class="thumbnail stat-thumbnail">
								<span class="glyphicon glyphicon-search"></span>
								<h1>{{stat.nbTotalObs}}</h1>
								<h3> {{ 'observations' if stat.nbTotalObs > 1 else 'observation' }}</h3>
								<p style="margin: 0 0 7px;"><a id="localScroll" href="#DernieresObservations" class="btn btn-default" role="button">Dernières observations</a></p>
							</div>
						</div>
						<div class = "col-lg-4 col-md-4 col-sm-6 col-xs-12 stat-object">
							<div class="thumbnail stat-thumbnail">
								<span class="glyphicon glyphicon-leaf"></span>
								<h1>{{stat.nbTotalTaxons}}</h1>
								<h3> {{ 'espèces' if stat.nbTotalTaxons > 1 else 'espèce' }}</h3>
								<form style="margin: 0 0 7px;" method="POST" id="searchFormTaxonsStat" class="navbar-form" role="search">
									<div class="form-group has-feedback">
										<input id="searchTaxonsStat" type="text" class="form-control" placeholder="Une espèce ?" loading="true" style="background-image: url('{{url_for('static', filename='images/loading3.gif') }}');" disabled>
										<i class="glyphicon glyphicon-search form-control-feedback"></i>
										<input id="hiddenInputTaxonStat" type="hidden" name="cd_ref">
									</div>
                				</form>
							</div>
						</div>
						<div class ="col-lg-4 col-md-4 col-sm-6 col-xs-12 stat-object">
							<div class="thumbnail stat-thumbnail">
								<span class="glyphicon glyphicon-camera"></span>
								<h1>{{stat.photo}}</h1>
								<h3> {{ 'photos' if stat.photo > 1 else 'photo' }}</h3>
								<p style="margin: 0 0 9px;"><a href="{{url_for('main.photos')}}" class="btn btn-default" role="button">Galerie photos</a></p>
							</div>
						</div>

						<div class ="col-lg-4 col-md-4 col-sm-6 col-xs-12 hidden-lg hidden-md stat-object">
							<div class="thumbnail stat-thumbnail">
								<img id="picto" src="{{url_for('static', filename='images/commune-icone.png')}}">
								<!--img id="picto" src="{{url_for('static', filename='images/commune-icone.png')}}"-->
								<h1>{{stat.town}}</h1>
								<h3> {{ 'communes' if stat.town > 1 else 'commune' }}</h3>
								<form style="margin: 0 0 7px;" method="POST" onsubmit="completeAction('#searchFormCommunesStat', hiddenInputCommunesStat)" id='searchFormCommunesStat' action=""  class="navbar-form" role="search">
									<div class="form-group has-feedback">
										<input id="searchCommunesStatsmallindex" type="text" class="form-control" placeholder="Une commune ?" >
										<i class="glyphicon glyphicon-search form-control-feedback"></i>
										<input id="hiddenInputCommunesStat" type="hidden" name="insee">
									</div>
								</form>
							</div>
						</div>
					
					</div>
					<div class="row">

						<div class ="col-lg-4 col-md-4 col-sm-6 col-xs-12 hidden-sm hidden-xs stat-object">
							<div class="thumbnail stat-thumbnail">
								<img id="picto" src="{{url_for('static', filename='images/commune-icone.png')}}">
								<!--img id="picto" src="{{url_for('static', filename='images/commune-icone.png')}}"-->
								<h1>{{stat.town}}</h1>
								<h3> {{ 'communes' if stat.town > 1 else 'commune' }}</h3>
								<form style="margin: 0 0 7px;" method="POST" onsubmit="completeAction('#searchFormCommunesStat', hiddenInputCommunesStat)" id='searchFormCommunesStat' action=""  class="navbar-form" role="search">
									<div class="form-group has-feedback">
										<input id="searchCommunesStat" type="text" class="form-control" placeholder="Une commune ?" >
										<i class="glyphicon glyphicon-search form-control-feedback"></i>
										<input id="hiddenInputCommunesStat" type="hidden" name="insee">
									</div>
								</form>
							</div>
						</div>
						<div class ="col-lg-4 col-md-4 col-sm-6 col-xs-12 stat-object">
							<div class="thumbnail stat-thumbnail">
								<span class="glyphicon glyphicon-flag"></span>
								<h1>{{stat.epci}}</h1>
								<h3> {{ 'intercommunalités' if stat.epci > 1 else 'intercommunalité' }} </h3>
								<form style="margin: 0 0 7px;" method="POST" onsubmit="completeAction('#searchFormEpciStat', hiddenInputEpciStat)" id='searchFormEpciStat' action=""  class="navbar-form" role="search">
									<div class="form-group has-feedback">
										<input id="searchEpciStat" type="text" class="form-control" placeholder="Un EPCI ?" >
										<i class="glyphicon glyphicon-search form-control-feedback"></i>
										<input id="hiddenInputEpciStat" type="hidden" name="nom_epci_simple">
									</div>
								</form>
							</div>
						</div>
						<div class ="col-lg-4 col-md-4 col-sm-6 col-xs-12 stat-object">
							<div class="thumbnail stat-thumbnail">
								<span class="glyphicon glyphicon-tower"></span>
								<h1>{{stat.departement}}</h1>
								<h3> {{ 'départements' if stat.departement > 1 else 'département' }} </h3>
								<form style="margin: 0 0 7px;" method="POST" onsubmit="completeAction('#searchFormDepartementStat', hiddenInputDepartementStat)" id='searchFormDepartementStat' action=""  class="navbar-form" role="search">
									<div class="form-group has-feedback">
										<input id="searchDepartementStat" type="text" class="form-control" placeholder="Un département ?" >
										<i class="glyphicon glyphicon-search form-control-feedback"></i>
										<input id="hiddenInputDepartementStat" type="hidden" name="num_dpt">
									</div>
								</form>
							</div>
						</div>

					</div>

				</div>
			</div>
			{% endif %}

			{% if customStatMedias != None and configuration.AFFICHAGE_RANG_STAT %}
			<!-- Statistiques par rang taxonomique -->
			<div class="col-sm-12">
				<div class="row row-medias">
				{% for i in range(customStatMedias | length) %}
					{% if configuration.COLONNES_RANG_STAT == 2 %}
					<div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 stat-medias-wrapper">
					{% elif configuration.COLONNES_RANG_STAT == 3 %}
					<div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 stat-medias-wrapper">
					{% elif configuration.COLONNES_RANG_STAT == 4 %}
					<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12 stat-medias-wrapper">
					{% endif %}
					<div class="panel panel-default statMedias">
						<div class="panel-heading">
							<h3>{{configuration.RANG_STAT_FR[i]}} </h3>
							<span class="higlight">{{customStat[i].nb_obs}}</span> observations | <span class="higlight">{{customStat[i].nb_taxons}}</span> espèces
						</div>
						<h5><span class="glyphicon glyphicon-eye-open"></span> Espèces à découvrir</h5>
					{% for j in range(2) %}
						{% if loop.index <= customStatMedias[i] | length %}
								<div class="col-lg-6 col-md-6 col-sm-12 col-xs-12 col-stat-medias">
									<div class ="thumbnail-stat-medias">
										<div class="zoom-wrapper">
											<a href="{{url_for('main.ficheEspece',cd_ref=customStatMedias[i][j].cd_ref)}}" >
                          						{% if configuration.TAXHUB_URL != None %}
										    	  <div class="img-custom-medias" style="background-image: url({{configuration.TAXHUB_URL}}/api/tmedias/thumbnail/{{customStatMedias[i][j].id_media}}?h=500&w=500)"></div>
                          						{% else %}
										    	  <div class="img-custom-medias" style="background-image: url({{customStatMedias[i][j].path}})"></div>
                          						{% endif %}
										    	<div class="stat-medias-hovereffet">
										    		<img src="{{url_for('static', filename='images/eye.png') }}">
										    		<h2 class="overlay-obs">{{customStatMedias[i][j].nb_obs}} observations</h2>
										    	</div>
											</a>
										</div>
									    <div class="thumbnail-caption-medias" >
									        <p>{% if customStatMedias[i][j].nom_vern != None %} {{customStatMedias[i][j].nom_vern}} {% endif %} <br/><i>{{customStatMedias[i][j].lb_nom}}</i></p>
									        <p><a href="{{url_for('main.ficheEspece',cd_ref=customStatMedias[i][j].cd_ref)}}" class="btn btn-default" role="button">Fiche espèce</a></p>
									    </div>
									</div>
								</div>
						{% endif %}
					{% endfor %}
							</div>
					</div>

			{% endfor %}
				</div>
			</div>
			{% endif %}

			{% if configuration.AFFICHAGE_DERNIERES_OBS %}
			<!-- Dernières espèces observées (Carte et liste) -->
			<div class="col-sm-12" id="DernieresObservations">
					<div class="panel panel-default" >
					  	<div class="panel-heading"><h3> {{configuration.TEXT_LAST_OBS}} {{observations | length}} {{ 'observations' if observations | length > 1 else 'observation' }}</h3></div>
					  	<div class="row" id="mapRow">
							<!-- CARTE des dernières observations -->
							<div id="blocMap" class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
								<div id="map"></div>
							</div>
							<!-- LISTE des dernières observations -->
							<div id="listMap" class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
								<table id='tableEspece' class="table">

									<tbody>
										{% for obs in observations %}
										<tr class='tabEspece' idSynthese = "{{obs.id_observation}}">
											<!-- <td class="singleTaxon img">
											<div class ="pictoImg" style="background-image:url({{configuration.TAXHUB_URL}}/api/tmedias/thumbnail/{{obs.id_media}}?h=60&w=60);" data-toggle="tooltip" data-original-title="{{obs.group2_inpn}}" data-placement="left"></div>
										</td> -->
										<td class="singleTaxon img">
											{% if obs.pathImg == None %}
											<img class="singleTaxon" width="80%" src="{{url_for('static', filename='images/picto_' + obs.group2_inpn | replace(" ", "_") +'.png')}}" data-toggle="tooltip" data-original-title="{{obs.group2_inpn}}" data-placement="left">
											{% else %}
												{% if configuration.TAXHUB_URL != None %}
												<div class ="pictoImg pictoImgSmall" style="background-image:url({{configuration.TAXHUB_URL}}/api/tmedias/thumbnail/{{obs.id_media}}?h=60&w=60);" data-toggle="tooltip" data-original-title="{{obs.group2_inpn}}" data-placement="left"></div>
												{% else %}
												<div class ="pictoImg pictoImgSmall" style="background-image:url({{obs.pathImg}});" data-toggle="tooltip" data-original-title="{{obs.group2_inpn}}" data-placement="left"></div>
												{% endif %}
											{% endif %}
										</td>
										<td class="singleTaxon name" cdref="{{obs.cd_ref}}" > {{obs.taxon}}</td>
										<td class="singleTaxon date"> {{obs.dateobs}} </td>
										<td class="singleTaxon detail">
											<a href = "{{url_for('main.ficheEspece',cd_ref=obs.cd_ref)}}">
												<span class="glyphicon glyphicon-list" data-toggle="tooltip" data-original-title="Consulter la fiche espèce" data-placement="left"> </span>
											</a>
                      					</td>
										<td class="hiddenTd" hidden="true">{{obs.cd_ref}}</td>
										</tr>
										{% endfor %}
									</tbody>
								</table>
							 </div>
						</div>
					</div>
			</div>
			{% endif %}

			{% if configuration.AFFICHAGE_EN_CE_MOMENT %}
			<!-- ESPECES PERIODE -->
			<div class="col-sm-12" id="mostViewNow">
				<div class="panel panel-default">
					<div class="panel-heading"><h3>A voir en ce moment <span class="glyphicon glyphicon-question-sign helpTip" data-toggle="tooltip" data-original-title="Espèces les plus observées dans les 15 jours précédents et suivants aujourd'hui, toutes années confondues" data-placement="right"></span></h3></div>
					<div class="row thumbnail-row">
					{% for tax in mostViewTaxon %}
						<div class="col-lg-3 col-md-4 col-sm-6 col-xs-12 thumbnail-col">
						    <div class="hovereffect">
						        {% if tax.path == None %}
                      <img class="default-logo " src="{{url_for('static', filename='images/picto_' + tax.group2_inpn | replace(" ", "_") +'.png') }}" alt="">
						        {% else %}
                      {% if configuration.TAXHUB_URL != None %}
                        <div class ="pictoImg pictoImgMedium" style="background-image:url({{configuration.TAXHUB_URL}}/api/tmedias/thumbnail/{{tax.id_media}}?h=500&w=500);" data-toggle="tooltip" data-original-title="{{tax.group2_inpn}}" data-placement="left"></div>
                      {% else %}
						            <div class="img-responsive-logo" style="background-image:url({{tax.path}})"> </div>
                      {% endif %}
						        {% endif %}
						        <div class="overlay">
						           <h2>{{tax.taxonName}}</h2>
						           <a class="info" href="{{url_for('main.ficheEspece',cd_ref=tax.cd_ref)}}">Fiche espèce</a>
						        </div>
						    </div>
						</div>
					  {% endfor %}
					</div>
				</div>
			</div>
			{% endif %}

		</div>

        {% if configuration.AFFICHAGE_FOOTER %}
			{% include 'static/custom/templates/footer.html' %}
		{% endif %}

    	<script type="text/javascript">
  			var observations = {{observations|tojson}}
  			, communesSearch = {{communesSearch|tojson}}
            , epciSearch = {{epciSearch|tojson}}
            , departementSearch = {{departementSearch|tojson}}
  			, configuration = {{configuration|tojson}},
  			url_limit_dpt_territory = "{{url_for('static', filename='custom/dpt_pdl_simpli.json') }}",
  			url_limit_territory = "{{url_for('static', filename='custom/territoire.json') }}";
	  	</script>
	  	<script src="{{url_for('static', filename='custom/maps-custom.js') }}"></script>
		<script src="{{url_for('static', filename='mapGenerator.js') }}"></script>
		<script src="{{url_for('static', filename='mapHome.js') }}"></script>
	    <script src="{{url_for('static', filename='main.js') }}"></script>

    </body>
</html>
